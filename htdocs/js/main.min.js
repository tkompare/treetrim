google.load("visualization","1",{});$(document).ready(function(){$("#help-address").tooltip();var d=new google.maps.LatLng("41.845","-87.669");var s="3028961";var p="Location";var F=null;var e=null;var f=null;var C="";var q=new google.maps.Geocoder();var t="805";var c=false;var n=false;var a=false;var w=new Array();var b=new Array();var g=new Array();var I=new Array();var j=new Array();var l=null;var B=null;var D={};var v={zoom:11,mapTypeControl:true,streetViewControl:false,panControl:false,zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_TOP},mapTypeId:google.maps.MapTypeId.ROADMAP};var A=document.getElementById("theMap");var y=new google.maps.Map(A,v);y.setCenter(d);function E(){n=false;e="SELECT "+p+" FROM "+s}E();F=new google.maps.FusionTablesLayer(s,{query:e});F.setMap(y);H(e,false);$("#map-refresh").click(function(){yearCreation=$("#year-creation").val();yearCompleted=$("#year-completed").val();address=$("#address").val();if(yearCreation!="none"||yearCompleted!="none"){E();if(yearCreation!="all"||yearCompleted!="all"){e=e+" WHERE";if(yearCreation!="all"){e=e+" CreationDate >= '01/01/"+yearCreation+"' AND CreationDate <= '12/31/"+yearCreation+"'";C=" AND"}if(yearCompleted!="open"&&yearCompleted!="all"){n=true;e=e+C+" CompletionDate >= '01/01/"+yearCompleted+"' AND CompletionDate <= '12/31/"+yearCompleted+"'"}if(yearCompleted=="open"){n=true;e=e+C+" Status LIKE '%Open%'"}if(yearCompleted=="all"){n=true;e=e+C+" Status LIKE '%Completed%'"}}else{n=true;e=e+" WHERE Status LIKE '%Completed%'"}if(address!=""){a=true;address+=" Chicago IL";q.geocode({address:address},function(J,i){if(i==google.maps.GeocoderStatus.OK){if(c!=false){c.setMap(null)}y.setCenter(J[0].geometry.location);y.setZoom(14);c=new google.maps.Marker({position:J[0].geometry.location,map:y,animation:google.maps.Animation.DROP,title:address});e=e+" AND ST_INTERSECTS("+p+", CIRCLE(LATLNG"+J[0].geometry.location.toString()+","+t+"))";o(e)}else{alert("We could not locate your address: "+i)}})}else{a=false;$("#statResults").fadeOut(function(){$("#statResults").html("")});o(e)}}else{$("#yearWarn").html('<div class="alert alert-error alert-block"><a class="close" data-dismiss="alert">x</a>Choose both a Request and Completion year.</div>')}});$("#map-all").click(function(){E();if(c!=false){c.setMap(null)}o(e);$("#year-creation").val("none");$("#year-completed").val("none");$("#address").val("");$("#statResults").fadeOut(function(){$("#statResults").html("")})});function o(i){F.setMap(null);F=new google.maps.FusionTablesLayer(s,{query:i});F.setMap(y);H(i)}var z=new google.maps.FusionTablesLayer(3057562,{query:"SELECT geometry FROM 3057562"});$("#wards").click(function(){if($("#wards").is(":checked")){F.setMap(null);z.setMap(y);F.setMap(y)}else{z.setMap(null)}});function H(i){$("#numResults").fadeOut(function(){$("#numResults").html('<div class="alert"><strong>Calculating...</strong></div>')});$("#numResults").fadeIn();f=i.replace("SELECT "+p,"SELECT Count() ");m(f).send(G);if(n&&a){h(i)}}function m(J){var i=encodeURIComponent(J);return new google.visualization.Query("http://www.google.com/fusiontables/gvizdata?tq="+i)}function G(i){var J=0;if(i.getDataTable().getNumberOfRows()>0){J=parseInt(i.getDataTable().getValue(0,0))}$("#numResults").fadeOut(function(){$("#statsResults").fadeOut();$("#numResults").html('<div class="alert alert-success"><strong>'+k(J)+"</strong> Requests Selected</div>")});$("#numResults").fadeIn()}function k(i){i+="";x=i.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var J=/(\d+)(\d{3})/;while(J.test(x1)){x1=x1.replace(J,"$1,$2")}return x1+x2}function h(i){statQueryString=i.replace("SELECT "+p,"SELECT CreationDate, CompletionDate");m(statQueryString).send(r)}function r(i){numRows=parseInt(i.getDataTable().getNumberOfRows());for(B=1;B<=6;B++){I[B]=0}for(B=0;B<numRows;B++){w[B]=new XDate(i.getDataTable().getValue(B,0));b[B]=new XDate(i.getDataTable().getValue(B,1));l="DAYS TO COMPLETE REQUESTS";if(b[B]=="21600000"){l="DAYS SINCE REQUESTS OPENED";b[B]=new XDate()}g[B]=w[B].diffDays(b[B]);if(g[B]<100){I[1]++}else{if(g[B]<200){I[2]++}else{if(g[B]<300){I[3]++}else{if(g[B]<400){I[4]++}else{if(g[B]<500){I[5]++}else{I[6]++}}}}}}D.min=jStat.min(g);D.max=jStat.max(g);D.mean=jStat.mean(g);D.median=jStat.median(g);D.stdev=jStat.stdev(g);for(B=1;B<=6;B++){j[B]=[B,I[B]]}$("#statResults").fadeOut(function(){$("#statResults").html('<div class="alert alert-info"><strong>'+l+"<br/>"+u(D.min,0)+"</strong> minimum<br/><strong>"+u(D.max,0)+"</strong> maximum<br/><strong>"+u(D.mean,1)+"</strong> average<br/><strong>"+u(D.median,1)+"</strong> median<br/><strong>"+u(D.stdev,1)+'</strong> standard deviation<div id="flot" style="width:240px;height:100px"></div><p>&nbsp;</p></div>');$.plot($("#flot"),[{data:j}],{bars:{show:true},xaxis:{ticks:[[1,"0"],[2,"100"],[3,"200"],[4,"300"],[5,"400"],[6,"500"],[7,"&#x221E;"]]}})});$("#statResults").fadeIn()}function u(J,K){var i=Math.round(J*Math.pow(10,K))/Math.pow(10,K);return i}});