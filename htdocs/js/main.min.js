google.load("visualization","1",{});$(document).ready(function(){$("#help-address").tooltip();var a={};a.updateDate="2012-03-18";a.mapDOM=document.getElementById("theMap");a.CenterLatLng=new google.maps.LatLng("41.845","-87.669");a.treetrimLayer=null;a.treetrimTableId="3028961";a.treetrimColumn="Location";a.wardLayer=null;a.wardTableId="3057562";a.wardColumn="geometry";a.queryString=null;a.countQueryString=null;a.insertAnd="";a.geocoder=new google.maps.Geocoder();a.searchRadius="805";a.addrMarker=false;a.isStatsRequest=false;a.isAddressRequest=false;a.createDates=new Array();a.completeDates=new Array();a.dateDiffs=new Array();a.total=new Array();a.flot=new Array();a.openComplete=null;a.i=null;a.statResults={};a.queryText=null;a.numRows=null;a.subStr=null;a.subStr1=null;a.subStr2=null;a.regex=null;a.myOptions={zoom:11,mapTypeControl:true,streetViewControl:false,panControl:false,zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_TOP},mapTypeId:google.maps.MapTypeId.TERRAIN};a.radiusCircle=null;a.radiusCircleOptions=null;a.theMap=new google.maps.Map(a.mapDOM,a.myOptions);a.theMap.setCenter(a.CenterLatLng);function k(){a.isStatsRequest=false;a.queryString="SELECT "+a.treetrimColumn+" FROM "+a.treetrimTableId}k();a.treetrimLayer=new google.maps.FusionTablesLayer(a.treetrimTableId,{query:a.queryString});a.treetrimLayer.setMap(a.theMap);e(a.queryString,false);$("#map-refresh").click(function(){a.yearCreation=$("#year-creation").val();a.yearCompleted=$("#year-completed").val();a.address=$("#address").val();if(a.yearCreation=="none"||a.yearCompleted=="none"){$("#yearWarn").html('<div class="alert alert-error alert-block"><a class="close" data-dismiss="alert">x</a>Choose both a Request and Completion year.</div>')}else{k();if(a.yearCreation!="all"||a.yearCompleted!="all"){a.queryString=a.queryString+" WHERE";if(a.yearCreation!="all"){a.queryString=a.queryString+" CreationDate >= '01/01/"+a.yearCreation+"' AND CreationDate <= '12/31/"+a.yearCreation+"'";a.insertAnd=" AND"}if(a.yearCompleted!="open"&&a.yearCompleted!="all"){a.isStatsRequest=true;a.queryString=a.queryString+a.insertAnd+" CompletionDate >= '01/01/"+a.yearCompleted+"' AND CompletionDate <= '12/31/"+a.yearCompleted+"'"}if(a.yearCompleted=="open"){a.isStatsRequest=true;a.queryString=a.queryString+a.insertAnd+" Status LIKE '%Open%'"}if(a.yearCompleted=="all"){a.isStatsRequest=true;a.queryString=a.queryString+a.insertAnd+" Status LIKE '%Completed%'"}}else{a.isStatsRequest=true;a.queryString=a.queryString+" WHERE Status LIKE '%Completed%'"}if(a.address!=""){a.isAddressRequest=true;a.address+=" Chicago IL";a.geocoder.geocode({address:a.address},function(m,l){if(l==google.maps.GeocoderStatus.OK){if(a.addrMarker!=false){a.addrMarker.setMap(null)}a.theMap.setCenter(m[0].geometry.location);a.theMap.setZoom(14);a.addrMarker=new google.maps.Marker({position:m[0].geometry.location,map:a.theMap,animation:google.maps.Animation.DROP,title:a.address});if(a.radiusCircle!=null){a.radiusCircle.setMap(null)}f(m[0].geometry.location);a.queryString=a.queryString+" AND ST_INTERSECTS("+a.treetrimColumn+", CIRCLE(LATLNG"+m[0].geometry.location.toString()+","+a.searchRadius+"))";h(a.queryString)}else{alert("We could not locate your address: "+l)}})}else{if(a.addrMarker!=false){a.addrMarker.setMap(null)}if(a.radiusCircle!=null){a.radiusCircle.setMap(null)}a.isAddressRequest=false;$("#statResults").fadeOut(function(){$("#statResults").html("")});h(a.queryString)}}});function f(l){a.radiusCircleOptions={strokeColor:"#a0522d",strokeOpacity:0.4,strokeWeight:1,fillColor:"#a0522d",fillOpacity:0.05,map:a.theMap,center:l,clickable:false,zIndex:-1,radius:parseInt(a.searchRadius)};a.radiusCircle=new google.maps.Circle(a.radiusCircleOptions)}$("#map-all").click(function(){k();if(a.addrMarker!=false){a.addrMarker.setMap(null)}if(a.radiusCircle!=null){a.radiusCircle.setMap(null)}h(a.queryString);$("#year-creation").val("none");$("#year-completed").val("none");$("#address").val("");$("#statResults").fadeOut(function(){$("#statResults").html("")})});function h(l){a.treetrimLayer.setMap(null);a.treetrimLayer=new google.maps.FusionTablesLayer(a.treetrimTableId,{query:l});a.treetrimLayer.setMap(a.theMap);e(l)}a.wardLayer=new google.maps.FusionTablesLayer(a.wardTableId,{query:"SELECT "+a.wardColumn+" FROM "+a.wardTableId});$("#wards").click(function(){if($("#wards").is(":checked")){a.treetrimLayer.setMap(null);a.wardLayer.setMap(a.theMap);a.treetrimLayer.setMap(a.theMap)}else{a.wardLayer.setMap(null)}});function e(l){$("#numResults").fadeOut(function(){$("#numResults").html('<div class="alert"><strong>Calculating...</strong></div>')});$("#numResults").fadeIn();a.countQueryString=l.replace("SELECT "+a.treetrimColumn,"SELECT Count() ");b(a.countQueryString).send(i);if(a.isStatsRequest&&a.isAddressRequest){c(l)}}function b(l){a.queryText=encodeURIComponent(l);return new google.visualization.Query("http://www.google.com/fusiontables/gvizdata?tq="+a.queryText)}function i(l){a.numRows=0;if(l.getDataTable().getNumberOfRows()>0){a.numRows=parseInt(l.getDataTable().getValue(0,0))}$("#numResults").fadeOut(function(){$("#statsResults").fadeOut();$("#numResults").html('<div class="alert alert-info"><strong>'+g(a.numRows)+"</strong> Requests Selected</div>")});$("#numResults").fadeIn()}function c(l){a.statQueryString=l.replace("SELECT "+a.treetrimColumn,"SELECT CreationDate, CompletionDate");b(a.statQueryString).send(j)}function j(l){a.numStatsRows=parseInt(l.getDataTable().getNumberOfRows());for(a.i=1;a.i<=6;a.i++){a.total[a.i]=0}for(a.i=0;a.i<a.numStatsRows;a.i++){a.createDates[a.i]=new XDate(l.getDataTable().getValue(a.i,0));a.completeDates[a.i]=new XDate(l.getDataTable().getValue(a.i,1));a.openComplete="DAYS TO COMPLETE REQUESTS";if(a.completeDates[a.i]=="21600000"){a.openComplete="DAYS SINCE REQUESTS OPENED";a.completeDates[a.i]=new XDate(a.updateDate)}a.dateDiffs[a.i]=a.createDates[a.i].diffDays(a.completeDates[a.i]);if(a.dateDiffs[a.i]<100){a.total[1]++}else{if(a.dateDiffs[a.i]<200){a.total[2]++}else{if(a.dateDiffs[a.i]<300){a.total[3]++}else{if(a.dateDiffs[a.i]<400){a.total[4]++}else{if(a.dateDiffs[a.i]<500){a.total[5]++}else{a.total[6]++}}}}}}a.statResults.min=jStat.min(a.dateDiffs);a.statResults.max=jStat.max(a.dateDiffs);a.statResults.mean=jStat.mean(a.dateDiffs);a.statResults.median=jStat.median(a.dateDiffs);a.statResults.stdev=jStat.stdev(a.dateDiffs);for(a.i=1;a.i<=6;a.i++){a.flot[a.i]=[a.i,a.total[a.i]]}$("#statResults").fadeOut(function(){$("#statResults").html('<div class="alert alert-info"><strong>'+a.openComplete+"<br/>"+d(a.statResults.min,0)+"</strong> minimum<br/><strong>"+d(a.statResults.max,0)+"</strong> maximum<br/><strong>"+d(a.statResults.mean,0)+"</strong> average<br/><strong>"+d(a.statResults.median,0)+"</strong> median<br/><strong>"+d(a.statResults.stdev,0)+'</strong> standard deviation<div id="flot" style="width:240px;height:100px"></div><p>&nbsp;<br/>requests - vertical&nbsp;&nbsp;|&nbsp;&nbsp;days - horizonal</p></div>');$.plot($("#flot"),[{color:"rgba(255,50,50,0.66)",data:a.flot}],{bars:{show:true,fillColor:"rgba(255,50,50,0.25)"},xaxis:{ticks:[[1,"0"],[2,"100"],[3,"200"],[4,"300"],[5,"400"],[6,"500"],[7,"&#x221E;"]]}})});$("#statResults").fadeIn()}function g(l){l+="";a.subStr=l.split(".");a.subStr1=a.subStr[0];a.subStr2=a.subStr.length>1?"."+a.subStr[1]:"";a.regx=/(\d+)(\d{3})/;while(a.regx.test(a.subStr1)){a.subStr1=a.subStr1.replace(a.regx,"$1,$2")}return a.subStr1+a.subStr2}function d(l,m){a.roundResult=Math.round(l*Math.pow(10,m))/Math.pow(10,m);return a.roundResult}});